
const getRtStockData = require('datasrc').getRtStockData;
var data = new Map();

var loop = function() {
    setTimeout(() => {
        getRtStockData().then((r) => {
            // r: { time: xxx, list: [{ secID: xxx,price: xxx, high: xxx, low: xxx, yestClose: xxx }]}
            r.list.forEach((stock) => {
                data.set(stock.secID, { secID: stock.secID, price: stock.price, yestClose: stock.yestClose });
            });
        }).catch((err) => {
            console.log('find err when getting realtime stock data: ', err);
        }).then(loop);
    }, 5000);
}

loop();

exports.get = function (secID) {
    while(data.size === 0) {}
    return data.get(secID);
}
