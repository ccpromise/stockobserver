
const config = require('config');
const utility = require('utility');
const file = utility.file;
const time = utility.time;
const datasrc = require('datasrc');
const getSecID = datasrc.getSecID;
const getSecHalt = datasrc.getSecHalt;

var date, list;
/**
 * return stock secID list which are on the market today
 */
module.exports = function () {
    var today = time.format(today, 'YYYYMMDD');
    if(list === undefined || time.isAfter(today, date)) {
        return Promise.all([getSecID(), getSecHalt(today)]).then(([allSecID, haltSecID]) => {
            var halt = new Set(haltSecID);
            list = allSecID.filter((secID) => !halt.has(secID));
            date = today;
            return list;
        });
    }
    return Promise.resolve(list);
}
