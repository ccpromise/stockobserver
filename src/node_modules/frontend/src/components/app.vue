<template>
    <div>
        <nav id="topNav">
            <button type="button" v-on:click="select = 'producer'">Producer</button>
            <button type="button" v-on:click="select = 'simulate'">Simulate Result</button>
        </nav>
        <producer v-if="select === 'producer'" v-bind:httpRequest="httpRequest"></producer>
        <simulate v-if="select === 'simulate'" v-bind:httpRequest="httpRequest"></simulate>
    </div>
</template>

<script>
    var simulate = require('./simulate');
    var producer = require('./producer');

    module.exports = {
        el: '#app',
        data: function () {
            return {
                select: 'producer'
            }
        },
        computed: {
            host: function () {
                return 'http://liuccplayground.chinacloudapp.cn:1000';
            }
        },
        components: {
            simulate: simulate,
            producer: producer
        },
        methods: {
            httpRequest: function (path, data, verb, callback) {
                var req = new XMLHttpRequest();
                req.onreadystatechange = function () {
                    if(req.readyState === 4 ) {
                        callback(req.status === 200 ? req.responseText : new Error(req.responseText)); //TODO change to http error with status code
                    }
                }
                req.open('POST', this.host + path, true);
                req.setRequestHeader('verb', verb);
                req.send(JSON.stringify(data));
            }
        }
    }
</script>
