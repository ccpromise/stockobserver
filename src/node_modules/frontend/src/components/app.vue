<template>
    <div>
        <nav class="col-12" id="topNav">
            <div class="navitem" v-bind:class="{ current: select === 'producer' }" type="div" v-on:click="select = 'producer'">Producer</div>
            <div class="navitem" v-bind:class="{ current: select === 'simulate' }" type="div" v-on:click="select = 'simulate'">Simulate</div>
            <!--<div class="navitem" v-bind:class="{ current: select === 'realtime' }" type="div" v-on:click="select = 'realtime'">Realtime</div>-->
        </nav>
        <div class="col-12" id="maincontent">
            <producer v-if="select === 'producer'" v-bind:httpRequest="httpRequest"></producer>
            <simulate v-if="select === 'simulate'" v-bind:httpRequest="httpRequest"></simulate>
            <!--<realtime v-if="select === 'realtime'" v-bind:httpRequest="httpRequest"></realtime>-->
        </div>
    </div>
</template>

<script>
    var realtime = require('./realtime');
    var simulate = require('./simulate');
    var producer = require('./producer');

    module.exports = {
        el: '#app',
        data: function () {
            return {
                select: 'producer'
            }
        },
        computed: {
            host: function () {
                return 'http://liuccplayground.chinacloudapp.cn:1500';
            }
        },
        components: {
            simulate: simulate,
            producer: producer,
            realtime: realtime
        },
        methods: {
            httpRequest: function (path, data, verb, callback) {
                var req = new XMLHttpRequest();
                req.onreadystatechange = function () {
                    if(req.readyState === 4 ) {
                        callback(req.status === 200 ? req.responseText : new Error(req.responseText)); //TODO change to http error with status code
                    }
                }
                req.open('POST', this.host + path, true);
                req.setRequestHeader('verb', verb);
                req.send(JSON.stringify(data));
            }
        }
    }
</script>
