<template>
    <div class="col-12 mt20">
        <table class="col-12" style="text-align: left">
            <tr>
                <th><span v-on:click="sortBy('secID')" v-bind:style="{ color: (sortKey === 'secID' ? 'green' : 'black')}">SecID</span></th>
                <th><span>Closed</span></th>
                <th><span v-on:click="sortBy('st')" v-bind:style="{ color: (sortKey === 'st' ? 'green' : 'black')}">StartDate</span></th>
                <th><span>StartPrice</span></th>
                <th><span>LatestDate/EndDate</span></th>
                <th><span>LatestPrice/EndPrice</span></th>
                <th><span>tradeplanId</span></th>
            </tr>
            <tr v-for="item in paginatedItems">
                <td>{{item.secID}}</td>
                <td>{{item.closed}}</td>
                <td>{{item.st | formatTs}}</td>
                <td>{{item.sp | numeral}}</td>
                <td>{{item.et | formatTs}}</td>
                <td>{{item.ep | numeral}}</td>
                <td>{{item.tradeplanId}}</td>
            </tr>
        </table>
    </div>
</template>

<script>
    module.exports = {
        props: ['httpRequest'],
        data: function () {
            return {
                sortKey: 'st',
                order: -1
            }
        },
        filters: {
            formatTs: function (dateTs) {
                return new Date(dateTs * 24 * 60 * 60 * 1000).toISOString().slice(0, 10);
            },
            numeral: function (num) {
                return num.toFixed(2);
            }
        },
        computed: {
            sort: function () {
                var res = Object.create(null);
                res[this.sortKey] = this.order;
                return res;
            },
            path: function () {
                return '/rtSimulate';
            },
            verb: function () {
                return 'getAll';
            }
        },
        methods: {
            data: function (page) {
                return {
                    filter: null,
                    sort: this.sort
                }
            },
            selectPage: function (page) {
                this.httpRequest(this.path, this.data(Math.max(1, page)), this.verb, (r) => {
                    var res = r instanceof Error ? {
                        total: 0,
                        data: []
                    } : JSON.parse(r);
                    this.totalItems = res.total;
                })
            },
            update: function () {
                this.selectPage(this.currentPage);
            },
            sortBy: function (key) {
                if (key === this.sortKey) this.order = -this.order;
                else {
                    this.sortKey = key;
                    this.order = 1;
                }
                this.selectPage(this.currentPage);
            }
        },
        mounted: function () {
            this.selectPage(1);
        }
    }
</script>
