
const CachedDataPvd = require('basicDataPvd').CachedDataPvd;

/**
 * base class for statistics data provider.
 * .get(ts) based on a window of this.pvd.get(ts) ~ this.pvd.get(ts backward N days)
 */
function StatDataPvd(pvd, N, id) {
    CachedDataPvd.call(this, id);

    this.minTs = pvd.forwardDateTs(pvd.minTs, N-1);
    this.maxTs = this.minTs == -1 ? -1 : pvd.maxTs;
    this.pvd = pvd;
    this.N = N;
}

StatDataPvd.prototype = Object.create(CachedDataPvd.prototype);

StatDataPvd.prototype.hasDef = function(ts) {
    return ts >= this.minTs && ts <= this.maxTs && this.pvd.hasDef(ts);
}

StatDataPvd.prototype.forwardDateTs = function(ts, n) {
    var fwTs = this.pvd.forwardDateTs(ts, n);
    return this.hasDef(fwTs) ? fwTs : -1;
}

StatDataPvd.prototype.backwardDateTs = function(ts, n) {
    var bwTs = this.pvd.backwardDateTs(ts, n);
    return this.hasDef(bwTs) ? bwTs : -1;
}

module.exports = StatDataPvd;
