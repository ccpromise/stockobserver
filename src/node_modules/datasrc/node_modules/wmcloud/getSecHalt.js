
const utility = require('utility');
const access_token = require('config').access_token;

const opt = {
    host: 'api.wmcloud.com',
    path: '/data/v1/api/master/getSecHalt.json',
    headers: {
        'Authorization': 'Bearer ' + access_token,
    },
    useHttps: true
}

module.exports = function(beginDate, endDate) {
    endDate = endDate || beginDate;
    return Promise.resolve().then(() => {
        var option = utility.object.clone(opt);
        option.query = 'beginDate='+beginDate+'&endDate='+endDate;
        //wmcloud is an https api
        return utility.request(option).then((r) => {
            var data = JSON.parse(r.toString());
            if(data.retCode !== 1) return Promise.reject(new Error(data.retMsg));
            return data.data.filter((stock) => stock.assetClass === 'E' && stock.listStatusCD === 'L' && (stock.exchangeCD === 'XSHE' || stock.exchangeCD === 'XSHG')).map((stock) => {
                return stock.secID.toLowerCase();
            });
        })
    })
};
