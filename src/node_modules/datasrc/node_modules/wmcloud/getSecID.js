
const request = require('utility').request;
const access_token = require('config').access_token;

const opt = {
    host: 'api.wmcloud.com',
    path: '/data/v1/api/master/getSecID.json',
    query: 'assetClass=E&field=secID,listStatusCD,exchangeCD',
    headers: {
        'Authorization': 'Bearer ' + access_token,
    },
    useHttps: true
}

module.exports = function() {
    return request(opt).then((content) => {
        var r = JSON.parse(content.toString());
        if(r.retCode !== 1) return Promise.reject(new Error(r.retMsg));
        return r.data.filter((stock) => ['0', '3', '6'].indexOf(stock.secID[0]) > -1 && stock.listStatusCD === 'L' && (stock.exchangeCD === 'XSHE' || stock.exchangeCD === 'XSHG')).map((stock) => {
            return stock.secID.toLowerCase();
        });
    });
}
