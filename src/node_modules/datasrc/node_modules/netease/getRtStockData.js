
const utility = require('utility');
const fields = ['SYMBOL', 'PRICE', 'HIGH', 'LOW', 'YESTCLOSE'];
const opt = {
    host: 'quotes.money.163.com',
    path: '/hs/service/diyrank.php',
    query: 'page=0&query=STYPE:EQA&count=4000&type=query&fields=' + fields.join(',')
}

module.exports = function () {
    return utility.request(opt).then((r) => {
        var data = JSON.parse(r.toString());
        return {
            time: data.time,
            list: data.list.map((stock) => {
                return {
                    secID: utility.stock.symbol2secID(stock.SYMBOL),
                    price: stock.PRICE,
                    high: stock.HIGH,
                    low: stock.LOW,
                    yestClose: stock.YESTCLOSE
                }
            })
        }
    })
}
