
const utility = require('utility');
const Database = utility.database;
const file = utility.file;
const validate = utility.validate;
const config = require('config');
const path = require('path');
const db = new Database(config.mongoUrl);

function writeFileToCollection (fileName, colName) {
    if(path.extname(fileName) !== '.json') {
        console.log('must be a JSON file');
        return;
    }
    var filePath = path.join(config.sysdataDir, fileName);
    return file.readFile(filePath).then((r) => {
        var data = JSON.parse(r.toString());
        console.log(data);
        var col = db.getCollection(colName);
        if(validate.isArr(data) && data.every(validate.isObj)){
            return col.insertMany(data);
        }
        if(validate.isObj(data)) {
            return col.insert(data);
        }
        console.log('data must be array or object');
    }).then(() => { return db.close(); });
}

writeFileToCollection(process.argv[2], process.argv[3]);
