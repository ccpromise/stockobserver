
const utility = require('utility');
const Database = utility.database;
const file = utility.file;
const config = require('config');
const path = require('path');
const db = new Database(config.mongoUrl);

/**
 * read a collection documents to a file in sysdataDir.
 * default format is .json
 */
function readCollectionToFile (col, fileName) {
    var filePath = path.join(config.sysdataDir, fileName);
    var extend = path.extname(fileName)|| '.json'
    return db.getCollection(col).find({}).then((data) => {
        if(extend === '.json') data = JSON.stringify(data);
        return file.writeFile(filePath, data);
    }).then(() => { return db.close(); });
}

readCollectionToFile(process.argv[2], process.argv[3]);
