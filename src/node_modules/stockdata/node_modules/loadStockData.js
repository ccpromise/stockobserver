
const config = require('config');
const useLocalData = config.useLocalData;
const stockDir = config.stockDataDir;
const container = config.stockdataContainer;
const path = require('path');
const utility = require('utility');
const file = utility.file;
const azure = utility.azureStorage(config.azureUsr);
const parseData = require('parseData');

function loadStockData(secID) {
    var fileName = secID + '.json';
    return (useLocalData
    ? file.readFile(path.join(stockDir, fileName))
    : azure.getBlobToText(container, fileName)
    ).then((r) => {
        var data = JSON.parse(r.toString());
        parseData(data);
        return data;
    })
}

module.exports = loadStockData;
